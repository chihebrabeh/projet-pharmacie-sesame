"use strict";!function(){var t;t=new ApiClient(window.config.api.host,window.config.api.token),new Vue({el:"[data-vue=products]",data:{products:[],categories:[],filterActive:!1,showPrice:!0,pageCount:1,filter:{category:null,page:1},cart:"undefined"!=typeof CartStore?CartStore.state:null},computed:{pagedProducts:function(){var i=this,t=this.products;this.filter.category&&0<this.filter.category&&(t=t.filter(function(t){for(var e in t.categories)if(i.filter.category==t.categories[e].id)return!0;return!1}));var e=30*(this.filter.page-1);return this.pageCount=Math.ceil(t.length/30),t.slice(e,30+e)}},created:function(){var o=this;t.calatalogGetProducts(function(t,e){t&&(e=[]);var i=[],r=[{id:-1,name:"Tous les produits"}];e.forEach(function(t){t.categories.forEach(function(t){-1===i.indexOf(t.id)&&(r.push(t),i.push(t.id))})}),o.products=e,o.categories=r}),this.setFilter(function(){for(var t,e={},i=window.location.href.replace(/^.*\?/,"").replace(/(#.*$)/,"").split("&"),r=/(.*)\[\]$/,o=0;o<i.length;o++){var n=i[o].split("="),a=decodeURIComponent(n[0]),c=decodeURIComponent(n[1]),s=a.match(r);s&&(a=s[1],(t=e[a]?e[a]:[]).push(c),c=t),e[a]=c}return e}()),window.onpopstate=function(t){o.setFilter(t.state)}},methods:{openFilter:function(){this.filterActive=!0},closeFilter:function(){this.filterActive=!1},selectCategory:function(t){this.filter.category=t.id,this.filter.page=1,this.closeFilter(),this.updateHistory()},selectPage:function(t){this.filter.page=t,this.updateHistory()},updateHistory:function(){var t={category:0<this.filter.category?this.filter.category:null,page:this.filter.page},e=location.origin+location.pathname+"?"+function(t){var e="";for(var i in t){var r=t[i];if(Array.isArray(r))for(var o=0;o<r.length;o++)e+=(""==e?"":"&")+i+"[]="+encodeURIComponent(r[o]);else r&&"false"!=r&&(e+=(""==e?"":"&")+i+"="+encodeURIComponent(r))}return e}(t);window.history.pushState(JSON.parse(JSON.stringify(t)),"Recherche",e)},setFilter:function(t){this.filter={category:t.category?t.category:-1,page:t.page?t.page:1}},addToCart:function(t){"undefined"!=typeof CartStore&&CartStore.addProduct(t,1)}},filters:{aspect_ratio:function(t,e){if(!t||!e)return t;if("nopic.png"==t.substr(-9))return t;var i=t.lastIndexOf(".");return-1==i?t:t.slice(0,i)+"-"+e+t.slice(i)},format_price:function(t){return"number"==typeof t?t.toFixed(2):t}}})}();